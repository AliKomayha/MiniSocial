@model IEnumerable<dynamic>
@{
    ViewData["Title"] = "Follow Requests";
}

<div class="container mt-5" style="max-width:600px;">
    <h2 class="fw-bold mb-4 text-center">Follow Requests</h2>

    @if (!Model.Any())
    {
        <p class="text-muted text-center">No pending follow requests.</p>
    }
    else
    {
        @foreach (var req in Model)
        {
            <div class="card mb-3 shadow-sm" style="border-radius:12px;">
                <div class="card-body d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <img src="@req.Avatar" class="rounded-circle me-3" style="width:50px; height:50px; object-fit:cover;" />
                        <div>
                            <strong>@req.DisplayName</strong>
                            <div class="text-muted">@("@" + req.Username)</div>
                        </div>
                    </div>
                    <div>
                        <button class="btn btn-success btn-sm accept-btn" data-id="@req.Id">Accept</button>
                        <button class="btn btn-outline-danger btn-sm decline-btn" data-id="@req.Id">Decline</button>
                    </div>
                </div>
            </div>
        }
    }
</div>

@section Scripts {
    <script>
        document.addEventListener("click", function (e) {
            const acceptBtn = e.target.closest(".accept-btn");
            const declineBtn = e.target.closest(".decline-btn");
            if (!acceptBtn && !declineBtn) return;

            const followId = (acceptBtn || declineBtn).getAttribute("data-id");
            const isAccept = !!acceptBtn;

            fetch(`/Profiles/${isAccept ? "AcceptRequest" : "DeclineRequest"}`, {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `followId=${followId}`
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    (acceptBtn || declineBtn).closest(".card").remove();
                }
            });
        });
    </script>
}
